<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
<META NAME="generator" CONTENT="http://txt2tags.org">
<TITLE>The mtCellEdit Handbook - Chapter 6 - mtCedCLI</TITLE></HEAD><BODY BGCOLOR="white" TEXT="black">
<CENTER>
</CENTER>

<P>
<A HREF="chap_05.html">Previous</A> | <A HREF="chap_00.html">Contents</A> | <A HREF="chap_07.html">Next</A>
</P>

<HR NOSHADE SIZE=1>

<H1>6. mtCedCLI</H1>

<P>
mtCedCLI is a program that provides spreadsheet functionality via a Command Line Interface (CLI).  It offers exactly the same functions as the GUI based mtCellEdit, but instead uses text commands.
</P>
<P>
Both GUI's and CLI's have value, and allow particular jobs to be done more efficiently.  For example I use mtCedCLI as part of the testing phase before I release the whole mtCellEdit suite.  I have created a number of tests in the form of scripts which test each part of the core libraries.  This exposes any problems that may have crept into the code, and is a good form of regression testing.
</P>

<A NAME="SEC1"></A>
<H3>6.1 Commands</H3>

<P>
mtCedCLI reads instructions from the user via GNU Readline.  This offers useful interactive facilities like using the up and down arrows to access previous commands.
</P>
<P>
It is also possible to run a script from the command line like these examples:
</P>

<PRE>
  cat script.txt | mtcedcli
  mtcedcli &lt; script.txt
  mtcedcli &lt; script.txt &gt; log.txt 2&gt;&amp;1
</PRE>

<P>
Here is the complete list of commands that mtCedCLI accepts:
</P>

<TABLE BORDER="1" CELLPADDING="4">
<TR>
<TD><B>Command</B></TD>
<TD><B>Arguments</B></TD>
<TD><B>Notes</B></TD>
</TR>
<TR>
<TD>about</TD>
<TD></TD>
<TD>About the program</TD>
</TR>
<TR>
<TD>clear content</TD>
<TD></TD>
<TD>Clear cell content in current selection</TD>
</TR>
<TR>
<TD>clear prefs</TD>
<TD></TD>
<TD>Clear cell preferences in current selection</TD>
</TR>
<TR>
<TD>clear</TD>
<TD></TD>
<TD>Clear cells in current selection</TD>
</TR>
<TR>
<TD>clip flip_h</TD>
<TD></TD>
<TD>Horizontal flip of clipboard</TD>
</TR>
<TR>
<TD>clip flip_v</TD>
<TD></TD>
<TD>Vertical flip of clipboard</TD>
</TR>
<TR>
<TD>clip load</TD>
<TD>&lt;OS FILENAME&gt;</TD>
<TD>Load clipboard from a file</TD>
</TR>
<TR>
<TD>clip save</TD>
<TD>&lt;OS FILENAME&gt;</TD>
<TD>Save the current clipboard to this file</TD>
</TR>
<TR>
<TD>clip rotate_a</TD>
<TD></TD>
<TD>Rotate the clipboard anticlockwise by 90 degrees</TD>
</TR>
<TR>
<TD>clip rotate_c</TD>
<TD></TD>
<TD>Rotate the clipboard clockwise by 90 degrees</TD>
</TR>
<TR>
<TD>clip transpose</TD>
<TD></TD>
<TD>Transpose the clipboard</TD>
</TR>
<TR>
<TD>copy output</TD>
<TD></TD>
<TD>Copy the output of the currently selected cells to the clipboard</TD>
</TR>
<TR>
<TD>copy values</TD>
<TD></TD>
<TD>Copy the values of the currently selected cells to the clipboard</TD>
</TR>
<TR>
<TD>copy</TD>
<TD></TD>
<TD>Copy the currently selected cells to the clipboard</TD>
</TR>
<TR>
<TD>cut</TD>
<TD></TD>
<TD>Copy the currently selected cells to the clipboard and clear the cells</TD>
</TR>
<TR>
<TD>delete column</TD>
<TD></TD>
<TD>Delete the currently selected column(s)</TD>
</TR>
<TR>
<TD>delete graph</TD>
<TD></TD>
<TD>Delete the currently active graph</TD>
</TR>
<TR>
<TD>delete row</TD>
<TD></TD>
<TD>Delete the currently selected row(s)</TD>
</TR>
<TR>
<TD>delete sheet</TD>
<TD></TD>
<TD>Delete the currently active sheet</TD>
</TR>
<TR>
<TD>duplicate sheet</TD>
<TD></TD>
<TD>Duplicate the currently active sheet</TD>
</TR>
<TR>
<TD>export graph</TD>
<TD>&lt;OS FILENAME&gt;</TD>
<TD>Export the current graph to this file</TD>
</TR>
<TR>
<TD>export output graph</TD>
<TD>&lt;OS FILENAME&gt; &lt;FILETYPE&gt;</TD>
<TD>Export the current graph output to this file and type (as per <A HREF="chap_05.html#SEC53">5.5.3</A>)</TD>
</TR>
<TR>
<TD>export output sheet</TD>
<TD>&lt;OS FILENAME&gt; &lt;FILETYPE&gt;</TD>
<TD>Export the current sheet output to this file and type (as per <A HREF="chap_05.html#SEC54">5.5.4</A>)</TD>
</TR>
<TR>
<TD>export sheet</TD>
<TD>&lt;OS FILENAME&gt; &lt;FILETYPE&gt;</TD>
<TD>Export the current sheet to this file and type (as per <A HREF="chap_05.html#SEC55">5.5.5</A>)</TD>
</TR>
<TR>
<TD>find</TD>
<TD>&lt;TEXT&gt; [wild] [case] [value] [all]</TD>
<TD>Find cells with this text (possibly using the current selection)</TD>
</TR>
<TR>
<TD>help</TD>
<TD>[ARG]...</TD>
<TD>Display help on this command</TD>
</TR>
<TR>
<TD>import book</TD>
<TD>&lt;OS FILENAME&gt;</TD>
<TD>Import a book from a file into the current book</TD>
</TR>
<TR>
<TD>import graph</TD>
<TD>&lt;GRAPH NAME&gt; &lt;OS FILENAME&gt;</TD>
<TD>Import a file as a graph and give it this name</TD>
</TR>
<TR>
<TD>info</TD>
<TD></TD>
<TD>Display current information</TD>
</TR>
<TR>
<TD>insert column</TD>
<TD>[clip]</TD>
<TD>Insert column(s) according to the current selection (or clipboard width)</TD>
</TR>
<TR>
<TD>insert row</TD>
<TD>[clip]</TD>
<TD>Insert row(s) according to the current selection (or clipboard height)</TD>
</TR>
<TR>
<TD>list files</TD>
<TD></TD>
<TD>List files in the active book</TD>
</TR>
<TR>
<TD>list graphs</TD>
<TD></TD>
<TD>List graphs in the active book</TD>
</TR>
<TR>
<TD>list sheets</TD>
<TD></TD>
<TD>List sheets in the active book</TD>
</TR>
<TR>
<TD>load</TD>
<TD>&lt;OS FILENAME&gt; [ csv <B>|</B> tsv ]</TD>
<TD>Load a new book</TD>
</TR>
<TR>
<TD>new book</TD>
<TD></TD>
<TD>Destroy the current book and start a new book with a sheet called "Sheet 1"</TD>
</TR>
<TR>
<TD>new sheet</TD>
<TD></TD>
<TD>Add a new empty sheet to the book</TD>
</TR>
<TR>
<TD>new</TD>
<TD></TD>
<TD>Destroy the current book and start a new book with a sheet called "Sheet 1"</TD>
</TR>
<TR>
<TD>paste content</TD>
<TD></TD>
<TD>Paste clipboard contents onto the current selection</TD>
</TR>
<TR>
<TD>paste prefs</TD>
<TD></TD>
<TD>Paste clipboard preferences onto the current selection</TD>
</TR>
<TR>
<TD>paste</TD>
<TD></TD>
<TD>Paste clipboard onto the current selection</TD>
</TR>
<TR>
<TD>print cell num</TD>
<TD></TD>
<TD>Print the cell number for all the selected cells</TD>
</TR>
<TR>
<TD>print cell text</TD>
<TD></TD>
<TD>Print the cell text for all the selected cells</TD>
</TR>
<TR>
<TD>print cell type</TD>
<TD></TD>
<TD>Print the cell type for all the selected cells</TD>
</TR>
<TR>
<TD>print prefs book</TD>
<TD></TD>
<TD>Print the book preferences</TD>
</TR>
<TR>
<TD>print prefs cell</TD>
<TD></TD>
<TD>Print the cell preferences in all the selected cells (that are not default)</TD>
</TR>
<TR>
<TD>print prefs sheet</TD>
<TD></TD>
<TD>Print sheet preferences</TD>
</TR>
<TR>
<TD>print prefs state</TD>
<TD></TD>
<TD>Print state preferences</TD>
</TR>
<TR>
<TD>print</TD>
<TD></TD>
<TD>Print the cell output for all the selected cells</TD>
</TR>
<TR>
<TD>q</TD>
<TD></TD>
<TD>Quit the program</TD>
</TR>
<TR>
<TD>quit</TD>
<TD></TD>
<TD>Quit the program</TD>
</TR>
<TR>
<TD>recalc book</TD>
<TD></TD>
<TD>Recalculate the book</TD>
</TR>
<TR>
<TD>recalc sheet</TD>
<TD></TD>
<TD>Recalculate the sheet</TD>
</TR>
<TR>
<TD>recalc</TD>
<TD></TD>
<TD>Recalculate the sheet</TD>
</TR>
<TR>
<TD>redo</TD>
<TD></TD>
<TD>Redo next sheet action</TD>
</TR>
<TR>
<TD>rename graph</TD>
<TD>&lt;NEW NAME&gt;</TD>
<TD>Rename the current graph</TD>
</TR>
<TR>
<TD>rename sheet</TD>
<TD>&lt;NEW NAME&gt;</TD>
<TD>Rename the current sheet</TD>
</TR>
<TR>
<TD>save</TD>
<TD></TD>
<TD>Save the current book</TD>
</TR>
<TR>
<TD>save as</TD>
<TD>&lt;OS FILENAME&gt; [FILETYPE]</TD>
<TD>Save the current book to this file (optionally changing the type as per <A HREF="chap_05.html#SEC52">5.5.2</A>)</TD>
</TR>
<TR>
<TD>select</TD>
<TD>&lt; all <B>|</B> CELLREF[:CELLREF] &gt;</TD>
<TD>Set the current cursor selection</TD>
</TR>
<TR>
<TD>set 2dyear</TD>
<TD>[ YEAR START ]</TD>
<TD>Change the currently selected cells if they contain a date with a 2 digit year</TD>
</TR>
<TR>
<TD>set book</TD>
<TD>&lt;INTEGER&gt;</TD>
<TD>Change the current active book (0..4)</TD>
</TR>
<TR>
<TD>set cell</TD>
<TD>&lt;CELL CONTENT&gt;</TD>
<TD>Set the cell text</TD>
</TR>
<TR>
<TD>set graph</TD>
<TD>&lt;GRAPH NAME&gt;</TD>
<TD>Set the current graph</TD>
</TR>
<TR>
<TD>set prefs book</TD>
<TD>&lt;KEY&gt; &lt;DATA&gt;</TD>
<TD>Set book preference (as per <A HREF="chap_A.html#SEC83">A.8.3</A>)</TD>
</TR>
<TR>
<TD>set prefs cell</TD>
<TD>&lt;KEY&gt; &lt;DATA&gt;</TD>
<TD>Set currently selected cell preferences (as per <A HREF="chap_A.html#SEC81">A.8.1</A>)</TD>
</TR>
<TR>
<TD>set prefs cellborder</TD>
<TD>&lt;DATA&gt;</TD>
<TD>Set currently selected cell border preferences (as per <A HREF="chap_05.html#SEC56">5.5.6</A>)</TD>
</TR>
<TR>
<TD>set prefs sheet</TD>
<TD>&lt;KEY&gt; &lt;DATA&gt;</TD>
<TD>Set the preferences for the current sheet (as per <A HREF="chap_A.html#SEC82">A.8.2</A>)</TD>
</TR>
<TR>
<TD>set prefs state</TD>
<TD>&lt;KEY&gt; &lt;DATA&gt;</TD>
<TD>Set the state preferences (as per <A HREF="chap_A.html#SEC84">A.8.4</A>)</TD>
</TR>
<TR>
<TD>set sheet</TD>
<TD>&lt;SHEET NAME&gt;</TD>
<TD>Set active sheet</TD>
</TR>
<TR>
<TD>set width</TD>
<TD>&lt; auto <B>|</B> INTEGER &gt;</TD>
<TD>Set selected columns width as integer &gt; 0 (0=default=10), or by calculating the current maximum width</TD>
</TR>
<TR>
<TD>sort column</TD>
<TD>&lt;EXPRESSION&gt;</TD>
<TD>Sort selected columns by expression as per <A HREF="chap_05.html#SEC57">5.5.7</A></TD>
</TR>
<TR>
<TD>sort row</TD>
<TD>&lt;EXPRESSION&gt;</TD>
<TD>Sort selected rows by expression as per <A HREF="chap_05.html#SEC57">5.5.7</A></TD>
</TR>
<TR>
<TD>undo</TD>
<TD></TD>
<TD>Undo last sheet action</TD>
</TR>
</TABLE>

<A NAME="SEC2"></A>
<H3>6.2 Book File Types</H3>

<TABLE BORDER="1" CELLPADDING="4">
<TR>
<TD>tsv_book</TD>
</TR>
<TR>
<TD>tsv_value_book</TD>
</TR>
<TR>
<TD>ledger_book</TD>
</TR>
<TR>
<TD>ledger_value_book</TD>
</TR>
</TABLE>

<A NAME="SEC3"></A>
<H3>6.3 Graph Output Types</H3>

<TABLE BORDER="1" CELLPADDING="4">
<TR>
<TD>eps</TD>
</TR>
<TR>
<TD>pdf</TD>
</TR>
<TR>
<TD>png</TD>
</TR>
<TR>
<TD>ps</TD>
</TR>
<TR>
<TD>svg</TD>
</TR>
</TABLE>

<A NAME="SEC4"></A>
<H3>6.4 Sheet Output Types</H3>

<TABLE BORDER="1" CELLPADDING="4">
<TR>
<TD>eps</TD>
</TR>
<TR>
<TD>html</TD>
</TR>
<TR>
<TD>pdf</TD>
</TR>
<TR>
<TD>pdf_paged</TD>
</TR>
<TR>
<TD>png</TD>
</TR>
<TR>
<TD>ps</TD>
</TR>
<TR>
<TD>svg</TD>
</TR>
<TR>
<TD>tsv</TD>
</TR>
<TR>
<TD>tsv_q</TD>
</TR>
</TABLE>

<A NAME="SEC5"></A>
<H3>6.5 Sheet Types</H3>

<TABLE BORDER="1" CELLPADDING="4">
<TR>
<TD>tsv</TD>
</TR>
<TR>
<TD>tsv_gz</TD>
</TR>
<TR>
<TD>tsv_noq</TD>
</TR>
<TR>
<TD>tsv_val</TD>
</TR>
<TR>
<TD>tsv_val_gz</TD>
</TR>
<TR>
<TD>tsv_val_noq</TD>
</TR>
<TR>
<TD>csv</TD>
</TR>
<TR>
<TD>csv_noq</TD>
</TR>
<TR>
<TD>csv_val</TD>
</TR>
<TR>
<TD>csv_val_noq</TD>
</TR>
<TR>
<TD>ledger</TD>
</TR>
<TR>
<TD>ledger_gz</TD>
</TR>
<TR>
<TD>ledger_val</TD>
</TR>
<TR>
<TD>ledger_val_gz</TD>
</TR>
</TABLE>

<A NAME="SEC6"></A>
<H3>6.6 Cell Border Codes</H3>

<TABLE BORDER="1" CELLPADDING="4">
<TR>
<TD>-1</TD>
<TD>Remove all borders</TD>
</TR>
<TR>
<TD>-2</TD>
<TD>Thin Outside</TD>
</TR>
<TR>
<TD>-3</TD>
<TD>Thick Outside</TD>
</TR>
<TR>
<TD>-4</TD>
<TD>Double Outside</TD>
</TR>
<TR>
<TD>-5</TD>
<TD>Thin Top And Bottom</TD>
</TR>
<TR>
<TD>-6</TD>
<TD>Thick Top And Bottom</TD>
</TR>
<TR>
<TD>-7</TD>
<TD>Double Top And Bottom</TD>
</TR>
</TABLE>

<PRE>
</PRE>

<TABLE BORDER="1" CELLPADDING="4">
<TR>
<TD></TD>
<TD><B>Horizontal</B></TD>
</TR>
<TR>
<TD>0</TD>
<TD>Clear Top</TD>
</TR>
<TR>
<TD>1</TD>
<TD>Clear Middle</TD>
</TR>
<TR>
<TD>2</TD>
<TD>Clear Bottom</TD>
</TR>
<TR>
<TD>3</TD>
<TD>Thin Top</TD>
</TR>
<TR>
<TD>4</TD>
<TD>Thin Middle</TD>
</TR>
<TR>
<TD>5</TD>
<TD>Thin Bottom</TD>
</TR>
<TR>
<TD>6</TD>
<TD>Thick Top</TD>
</TR>
<TR>
<TD>7</TD>
<TD>Thick Middle</TD>
</TR>
<TR>
<TD>8</TD>
<TD>Thick Bottom</TD>
</TR>
<TR>
<TD>9</TD>
<TD>Double Top</TD>
</TR>
<TR>
<TD>10</TD>
<TD>Double Middle</TD>
</TR>
<TR>
<TD>11</TD>
<TD>Double Bottom</TD>
</TR>
</TABLE>

<PRE>
</PRE>

<TABLE BORDER="1" CELLPADDING="4">
<TR>
<TD></TD>
<TD><B>Vertical</B></TD>
</TR>
<TR>
<TD>12</TD>
<TD>Clear Left</TD>
</TR>
<TR>
<TD>13</TD>
<TD>Clear Centre</TD>
</TR>
<TR>
<TD>14</TD>
<TD>Clear Right</TD>
</TR>
<TR>
<TD>15</TD>
<TD>Thin Left</TD>
</TR>
<TR>
<TD>16</TD>
<TD>Thin Centre</TD>
</TR>
<TR>
<TD>17</TD>
<TD>Thin Right</TD>
</TR>
<TR>
<TD>18</TD>
<TD>Thick Left</TD>
</TR>
<TR>
<TD>19</TD>
<TD>Thick Centre</TD>
</TR>
<TR>
<TD>20</TD>
<TD>Thick Right</TD>
</TR>
<TR>
<TD>21</TD>
<TD>Double Left</TD>
</TR>
<TR>
<TD>22</TD>
<TD>Double Centre</TD>
</TR>
<TR>
<TD>23</TD>
<TD>Double Right</TD>
</TR>
</TABLE>

<A NAME="SEC7"></A>
<H3>6.7 Sorting Expressions</H3>

<P>
&lt;INTEGER&gt; , &lt; a | d &gt; [c] [ , ... ]
</P>
<P>
For example, expression <B>1,ac,2,d</B> sorts by row/column 1 (ascending, case sensitive), then row/column 2 (descending).
</P>

<A NAME="SEC8"></A>
<H3>6.8 Shell Scripts</H3>

<P>
Because the interface to mtCedCLI is just text, this means that shell scripts can control the program.
</P>

<A NAME="SEC81"></A>
<H4>6.8.1 Putting Several Sheets into a Book</H4>

<P>
<A HREF="../shawk/cedsheetbook.sh">DOWNLOAD FILE</A>
</P>

<PRE>
  #!/bin/sh
  # cedsheetbook.sh - Puts sheet files into a single book file
  # usage: cedsheetbook.sh BOOKFILENAME SHEETFILE... | mtcedcli
  # e.g. cedsheetbook.sh ~/output.zip *.tsv *.csv | mtcedcli
  # by Mark Tyler 19th February 2013
  
  
  echo "delete sheet"
  echo "save as \"$1\""
  
  shift
  
  while [ "$1" != "" ]
  do
  	echo "import book \"$1\""
  	shift
  done
  
  echo "save"
</PRE>

<P>
The handy thing with this approach is that you can dry run the script first
by using:
</P>

<PRE>
  ./cedsheetbook.sh ~/output.zip *.tsv *.csv
</PRE>

<P>
If you are happy with the text output then you can commit the actions with:
</P>

<PRE>
  ./cedsheetbook.sh ~/output.zip *.tsv *.csv | mtcedcli
</PRE>

<A NAME="SEC82"></A>
<H4>6.8.2 Extracting Sheets From a Book</H4>

<P>
The following script does the reverse of the first script.
It reads a ZIP file and extracts all of the sheets to TSV files in the
given directory.
</P>
<P>
<A HREF="../shawk/cedbooksplit.sh">DOWNLOAD FILE</A>
</P>

<PRE>
  #!/bin/sh
  # cedbooksplit.sh - Extracts the sheets from a book
  # usage: cedbooksplit.sh BOOKFILENAME OUPUTDIRECTORY
  # e.g. cedbooksplit.sh ~/output.zip ~/temp_sheet
  # by Mark Tyler 19th February 2013
  
  # On error exit
  set -e
  
  mkdir -p "$2"
  
  TMP_FILE="$2"/tmp.txt
  
  printf "load \"$1\"\n" &gt; "$TMP_FILE"
  
  printf "load \"$1\"\nlist sheets" |
  mtcedcli -q |
  awk '!/^$/ &amp;&amp; !/^mtcedcli/' |
  while read SHEET
  do
  	LOWER=$(echo "$SHEET" | tr '[:upper:]' '[:lower:]')
  
  	case "$LOWER" in
  	*csv )	TYPE=csv;;
  	* )	TYPE=tsv;;
  	esac
  
  	echo set sheet \"$SHEET\" &gt;&gt; "$TMP_FILE"
  	echo export sheet \"$2/$SHEET\" $TYPE &gt;&gt; "$TMP_FILE"
  done
  
  cat "$TMP_FILE"
  
  echo
  echo Type y and press ENTER to run this script
  
  read KEY
  
  if [ "$KEY" = "y" ]
  then
  	cat "$TMP_FILE" | mtcedcli
  fi
  
  echo
</PRE>

<HR NOSHADE SIZE=1>

<P>
<A HREF="chap_05.html">Previous</A> | <A HREF="chap_00.html">Contents</A> | <A HREF="chap_07.html">Next</A>
</P>

<!-- html code generated by txt2tags 2.6 (http://txt2tags.org) -->
<!-- cmdline: txt2tags -t html -o chap_06.html chap_06.t2t -->
</BODY></HTML>
